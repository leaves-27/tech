# 使用react + redux + node 实现同构代码：

## 需要解决的问题：

  1.组件同构如何实现？   
  2.前后端应用状态如何保持一致？  
  3.前后端路由匹配如何解决？  
  4.服务端对静态资源的依赖如何处理？  
  5.开发环境和产品环境的配置如何写？  
  6.项目目录结构如何划分更合理？  

## 具体解决方案： 

1.如何实现组件同构(即前后端使用同一份视图代码)？  
  前端使用ReactDOM.render方法把编写好的组件转换成真实DOM最后渲染到界面上;后端使用ReactDOMServer.renderToString方法把编写好的组件转换成HTML字符串返回给前端。  

2.如何保持前后端应用状态一致？  
  服务端在每次刷新页面请求后，不仅把通过组件生成的字符串作为变量暴露给模板、而且把当前应用的状态编译成json字符串作为变量暴露给模板。这样在每次请求后，服务端编译生成并传送给前端的页面中，既有服务端生成的html，又有当前应用的状态。即前端可以拿到当前应用在服务器端的状态，然后将其传给redux的createStore方法供其生成store,然后再传给前端渲染方法引用的组件使用。这样就实现了前后端状态的一致。但这里又会造成一个重复渲染的问题。为了避免这个问题，服务端在通过ReactDOMServer.renderToString把应用组件渲染成字符串的时候，使用adler32算法根据之前生成的html字符串的内容生成了一个具有标识内容唯一性的字符串并把它赋给生成的Html字符串的第一个元素的data-react-checksum属性。然后前端在使用ReactDom.render方法渲染的时候，也会使用相同的逻辑来生成一个具有标识内容唯一性的字符串，然后把它和data-react-checksum属性的值进行对比。如果一致，则不进行重新渲染，否则，重新进行渲染。   

3.如何解决前后端路由匹配问题？   
  公用同一套路由。然后服务端在使用这一套路由的时候，react-router库提供match方法和RouterContext来实现。match将当前服务端请求的url拿去在公用路由中寻找匹配的组件，若找到，则会回传一个_redenerProps属性。然后把它传给RouterContext使用即解决了前后端路由的公用问题。  

4.如何处理服务端对静态资源的依赖？  
  
5.如何配置两套不同的环境（开发环境和产品环境）？   

6.如何划分更合理的项目目录结构？   

