# 网页授权
如果用户在微信客户端中访问第三方网页，公众号可以通过微信网页授权机制，来获取用户基本信息(openId、用户昵称、用户头像、性别、省份、城市、国家、用户微信特权、unionid等)，进而实现业务逻辑。

## 授权所需信息(4个必须字段)：
  根据微信授权URL的要求需提供：
  1.公众号的appId。
  2.授权成功或失败的回调地址URL。
  3.需要获取授权的信息的作用域(scope)。分为用来获取进入页面的用户的openid(snsapi_base)和用来获取用户的基本信息(snsapi_useinfo，即)的两种作用域。
  4.自定义参数state。
  5.响应类型response_type，其值为code。

## 授权流程
  1.用户通过点击或其他方式触发请求微信授权链接URL(由微信开发文档提供)。
  2.微信服务器接受请求后，根据作用域的值的不同返回不同页面URL(即根据作用域的值的不同让微信内置浏览器跳转到不同页面)。若作用域为snsapi_base，则直接跳转到给定的回调地址URL；若snsapi_userinfo，则返回需用户手动授权页，用户手动授权后，然后跳转到给定的回调地址URL。
  3.回调URL页面在页面初始化完成后，前端获取页面URL中的code，然后用其和appid等参数去自家服务器(公众号所属公司，区别于微信的服务器)请求进来的用户信息。自家服务器在接受到相关数据后，然后使用传过来的appId、code和在服务器上保存的公众号私钥及授权码去微信服务器请求，获取相关凭证。在微信服务器返回相关凭证到自家服务器后，自家服务器再使用相关凭证去微信服务器请求进来的用户信息，然后在获取到的时候将其返回给前端请求。
## 名词解释
  1.微信授权URL: https://open.weixin.qq.com/connect/oauth2/authorize#wechat_redire
  2.appId: 公众号的唯一标识.
  3.code: 临时权授权码，有效期为5分钟的授权码，用来换取可以访问用户信息的基础信息的凭证access_token。
  4.openId: 用户微信号和相关公众号加密生成的唯一字符串。即在特定微信公众号内的微信用户用户的唯一标识。相同的用户在同一个公众号内只有一个openId，在但不同的公众号中，每个公众号都有一个openId。
  5.UnionID: 在微信平台下的移动应用、网站应用和公众帐号之间是同一个.

## 授权引申
  若该公众号内嵌H5应用还支持其他非微信内嵌的场景，则需要考虑在进入该页面(即微信公众号场景的回调地址)时，若当前环境返回用户token，然后使用用户token获取用户基本信息。  

# 参考文献：
https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_webpage_authorization.html
